import { uniq } from 'es-toolkit'

import type { UrlDataviewInstance } from '@globalfishingwatch/dataviews-client'

import {
  EEZ_DATAVIEW_INSTANCE_ID,
  FAO_AREAS_DATAVIEW_INSTANCE_ID,
  RFMO_DATAVIEW_INSTANCE_ID,
} from 'data/workspaces'
import {
  ENCOUNTER_EVENTS_SOURCE_ID,
  LOITERING_EVENTS_SOURCE_ID,
  PORT_VISITS_EVENTS_SOURCE_ID,
} from 'features/dataviews/dataviews.utils'

export const AIS_DATAVIEW_INSTANCE_ID = 'ais'
export const VMS_DATAVIEW_INSTANCE_ID = 'vms'
export const PRESENCE_DATAVIEW_INSTANCE_ID = 'presence'
export const SAR_DATAVIEW_INSTANCE_ID = 'sar'
export const VIIRS_DATAVIEW_INSTANCE_ID = 'viirs'

const REPORT_EVENTS_DATAVIEW_INSTANCES_IDS: string[] = [
  AIS_DATAVIEW_INSTANCE_ID,
  VMS_DATAVIEW_INSTANCE_ID,
  PRESENCE_DATAVIEW_INSTANCE_ID,
  SAR_DATAVIEW_INSTANCE_ID,
  VIIRS_DATAVIEW_INSTANCE_ID,
  ENCOUNTER_EVENTS_SOURCE_ID,
  LOITERING_EVENTS_SOURCE_ID,
  PORT_VISITS_EVENTS_SOURCE_ID,
]

const CONTEXT_LAYERS_DATAVIEW_INSTANCES_IDS: string[] = [
  EEZ_DATAVIEW_INSTANCE_ID,
  RFMO_DATAVIEW_INSTANCE_ID,
  FAO_AREAS_DATAVIEW_INSTANCE_ID,
]

const CARRIER_PORTAL_DATAVIEW_INSTANCES_IDS: string[] = [
  ENCOUNTER_EVENTS_SOURCE_ID,
  ...CONTEXT_LAYERS_DATAVIEW_INSTANCES_IDS,
]

export const CARRIER_PORTAL_DATAVIEW_INSTANCES: UrlDataviewInstance[] = uniq([
  ...REPORT_EVENTS_DATAVIEW_INSTANCES_IDS,
  ...CONTEXT_LAYERS_DATAVIEW_INSTANCES_IDS,
]).map((id) => ({
  id,
  config: {
    visible: CARRIER_PORTAL_DATAVIEW_INSTANCES_IDS.includes(id),
  },
}))

export const REPORT_EVENTS_DATAVIEW_INSTANCES: UrlDataviewInstance[] =
  REPORT_EVENTS_DATAVIEW_INSTANCES_IDS.map((id) => ({
    id,
    config: {
      visible: true,
    },
  }))
